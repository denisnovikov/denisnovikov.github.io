<!DOCTYPE html><html lang="ru"><head>  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-89748707-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-89748707-1'); </script><base href="https://denisnovikov.github.io"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="google-site-verification" content="aiV-7fBXdNhcJILKp5GXFesXJetzCgLWAbif-tZKfrY" /><meta name="yandex-verification" content="41a2ad868168b23f" /><meta name="openstat-verification" content="62f671b1eaa0d2a7ce234219685a42b3d7770961" /><meta property="op:markup_version" content="v1.0"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="application-name" content="FrontEnd Blog"><meta name="format-detection" content="telephone=no"><meta name="generator" content="jekyll"><meta name="google" content="notranslate"><meta name="rating" content="General"><meta name="referrer" content="never"><meta name="robots" content="index,follow,noodp"><meta name="subject" content="blog"><meta name="url" content="https://denisnovikov.github.io"><meta name="viewport" content="width=device-width, initial-scale=1"><title> Приятная сборка front-end проекта - denisnovikov.github.io</title><meta name="description" content="В этой статье мы подробно разберем процесс сборки фронтенд проекта, который прижился в моей повседневной работе и очень облегчил рутину."><link rel="alternate" hreflang="ru" href="/blog/nice-build-frontend-project/" /><link rel="canonical" href="https://denisnovikov.github.io/blog/nice-build-frontend-project/"><link rel="author" href="DNovikov"><link rel="me" href="https://github.com/denisnovikov" type="text/html"><link rel="me" href="mailto:dnovikov1808@gmail.com"><link href='https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|Roboto+Condensed:700&subset=latin' rel='stylesheet' type='text/css'><link rel="stylesheet" href="/assets/css/main.css"><meta property="og:url" content="https://denisnovikov.github.io/blog/nice-build-frontend-project/"><meta property="og:type" content="website"><meta property="og:title" content="Приятная сборка front-end проекта"><meta property="og:description" content="В этой статье мы подробно разберем процесс сборки фронтенд проекта, который прижился в моей повседневной работе и очень облегчил рутину"><meta property="og:site_name" content="denisnovikov.github.io"><meta property="og:locale" content="ru_RU"><meta property="article:author" content="DNovikov"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@dev_novikov"><meta name="twitter:creator" content="@dev_novikov"><meta name="twitter:url" content="https://denisnovikov.github.io/blog/nice-build-frontend-project/"><meta name="twitter:title" content="Приятная сборка front-end проекта"><meta name="twitter:description" content="В этой статье мы подробно разберем процесс сборки фронтенд проекта, который прижился в моей повседневной работе и очень облегчил рутину"><meta property="og:image" content="https://denisnovikov.github.io/assets/images/bg.svg"><meta name="twitter:image" content="https://denisnovikov.github.io/assets/images/bg.svg"><body><div id="shadow"></div><header class="main-header content-wrapper"> <input type="checkbox" id="menu-checkbox" /><nav class="center-wrapper nav-main"> <a class="blog-logo" href="/">denisnovikov.github.io</a> <a href="/about/">О проекте</a> <a href="/blog/">Все записи блога</a> <a href="/feed.xml" rel="alternate" type="application/rss+xml">RSS</a> <label for="menu-checkbox" class="toggle-button" data-open="☰" data-close="☰" onclick></label></nav></header><aside class="sidebar" role="note" style=" background-image: url( /assets/images/front-end/nice-build-frontend-project/preview-nice-build-frontend-project.jpg )"><div class="cover"><div class="cover-text"><div class="heading"> <a href="/blog/#front-end">front-end</a></div><p> В этой статье мы подробно разберем процесс сборки фронтенд проекта, который прижился в моей повседневной работе и очень облегчил рутину Приятная сборка front-end проекта</div></div><div id="switcher"></div></aside><main class="content-wrapper"><article class="post"><h1 class="post-title">Приятная сборка front-end проекта</h1><p class="post-meta"> <time datetime="2015-02-14">14-02-2015</time> &nbsp;/&nbsp; <span>habrahabr.ru</span><div class="post-content"><p>В этой статье мы подробно разберем процесс сборки фронтенд проекта, который прижился в моей повседневной работе и очень облегчил рутину.<p>Статья не претендует на истину в последней инстанции, так как сегодня существует большое количество различных сборщиков и подходов к сборке, и каждый выбирает по вкусу. Я лишь поделюсь своими мыслями по этой теме и покажу свой workflow.<blockquote><p><strong>UPD (13 марта 2015)</strong>: Заменил несколько плагинов на более актуальные + решил проблему с импортом CSS файлов внутрь SCSS.</blockquote><p>Мы будем использовать сборщик Gulp. Соответственно у вас в системе должен быть установлен Node js. Установку ноды под конкретную платформу мы рассматривать не будем, т.к. это гуглится за пару минут.<p>И для начала отвечу на вопрос — почему Gulp? Из более или менее сносных альтернатив мы имеем Grunt и Brunch.<p>Когда я только начал приобщаться к сборщикам — на рынке уже были и Grunt и Gulp. Первый появился раньше и по этому имеет более большое коммьюнити и разнообразие плагинов. По данным с npm:<ul><li>Grunt — 11171 пакет<li>Gulp — 4371 пакет</ul><p>Но Grunt мне показался черезчур многословным. И после прочтения нескольких статей-сравнений — я предпочел Gulp за его простоту и наглядность.<p>Brunch — это сравнительно молодой проект, со всеми вытекающими из этого плюсами и минусами. Я с интересом наблюдаю за ним, но в работе пока не использовал.<h2 id="Приступим">Приступим</h2><p>Создадим папку под наш проект, например «habr». Откроем ее в консоли и выполним команду:<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>npm init</code></pre></figure><p>Можно просто нажать Enter на все вопросы установщика, т.к. сейчас это не принципиально.<p>В итоге в папке с проектом у нас сгенерируется файл package.json, примерно такого содержания:<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"habr"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"main"</span><span class="p">:</span><span class="w"> </span><span class="s2">"index.js"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"echo </span><span class="se">\"</span><span class="s2">Error: no test specified</span><span class="se">\"</span><span class="s2"> &amp;amp;&amp;amp; exit 1"</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="p">},</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"license"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ISC"</span><span class="w"><br data-jekyll-commonmark-ghpages="" /></span><span class="p">}</span></code></pre></figure><p>Немного видоизменим его под наши нужды:<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"habr"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"license"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ISC"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"gulp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.8.11"</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="p">}</span><span class="w"><br data-jekyll-commonmark-ghpages="" /></span><span class="p">}</span></code></pre></figure><p>В блоке dependencies мы указали что нам нужен gulp и тут же будем прописывать все наши плагины.<h2 id="Плагины">Плагины</h2><ul><li><a href="https://www.npmjs.com/package/gulp-autoprefixer">gulp-autoprefixer</a> — автоматически добавляет вендорные префиксы к CSS свойствам (пару лет назад я бы убил за такую тулзу);<li><a href="https://www.npmjs.com/package/gulp-minify-css">gulp-minify</a> — css - нужен для сжатия CSS кода;<li><a href="https://www.npmjs.com/package/browser-sync">browser-sync</a> — с помощью этого плагина мы можем легко развернуть локальный dev сервер с блэкджеком и livereload, а так же с его помощью мы сможем сделать тунель на наш localhost, что бы легко демонстрировать верстку заказчику;<li><a href="https://www.npmjs.com/package/gulp-imagemin">gulp-imagemin</a> — для сжатия картинок;<li><a href="https://www.npmjs.com/package/imagemin-pngquant">imagemin-pngquant</a> — дополнения к предыдущему плагину, для работы с PNG;<li><a href="https://www.npmjs.com/package/gulp-uglify">gulp-uglify</a> — будет сжимать наш JS;<li><a href="https://www.npmjs.com/package/gulp-sass">gulp-sass</a> — для компиляции нашего SCSS кода;<li><a href="https://www.npmjs.com/package/gulp-sourcemaps">gulp-sourcemaps</a> — возьмем для генерации css sourscemaps, которые будут помогать нам при отладке кода;<li><a href="https://www.npmjs.com/package/gulp-rigger">gulp-rigger</a> — это просто киллер фича. Плагин позволяет импортировать один файл в другой простой конструкцией и строка при компиляции будет заменена на содержимое файла;<li><a href="https://www.npmjs.com/package/gulp-watch">gulp-watch</a> — Будет нужен для наблюдения за изменениями файлов. Знаю что в Gulp есть встроенный watch, но у меня возникли с ним некоторые проблемы, в частности он не видел вновь созданные файлы, и приходилось его перезапускать. Этот плагин решил проблему (надеюсь в следующих версиях gulp это поправят);<li><a href="https://www.npmjs.com/package/rimraf">rimraf</a> — rm -rf для ноды;</ul><p>Установим все плагины и на выходе получим такой package.json:<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"habr"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"license"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ISC"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"browser-sync"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.2.3"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"gulp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.8.11"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"gulp-autoprefixer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.1.0"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"gulp-imagemin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.2.1"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"gulp-minify-css"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.0.0"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"gulp-rigger"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.5.8"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"gulp-sass"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.3.3"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"gulp-sourcemaps"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.5.0"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"gulp-uglify"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.1.0"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"gulp-watch"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.1.1"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"imagemin-pngquant"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.0.0"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"rimraf"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.3.1"</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="p">}</span><span class="w"><br data-jekyll-commonmark-ghpages="" /></span><span class="p">}</span></code></pre></figure><h2 id="bower">Bower</h2><p>Я уже не мыслю своей работы без пакетного менеджера <a href="https://bower.io/">Bower</a> и надеюсь вы тоже. Если нет, то почитать о том что это и с чем его едят можно <a href="http://nano.sapegin.ru/all/bower">тут</a>.<p>Давайте добавим его к нашему проекту. Для этого выполним в консоли команду:<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bower init</code></pre></figure><p>Можно так же Enter на все вопросы.<p>В конце мы получаем примерно такой файл bower.json:<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"habr"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0.0"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"authors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"Insayt &lt;insait.rostov @ya.ru&gt;"</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="p">],</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"license"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MIT"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"ignore"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"**/.*"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"node_modules"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"bower_components"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"test"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"tests"</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="p">]</span><span class="w"><br data-jekyll-commonmark-ghpages="" /></span><span class="p">}</span></code></pre></figure><p>И модифицируем его до нужного нам состояния:<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"habr"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0.0"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"authors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"Insayt &lt;insait.rostov @ya.ru&gt;"</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="p">],</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"license"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MIT"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"ignore"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"**/.*"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"node_modules"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"bower_components"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"test"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"tests"</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="p">],</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="s2">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"normalize.css"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w"><br data-jekyll-commonmark-ghpages="" />        </span><span class="s2">"jquery"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.*"</span><span class="w"><br data-jekyll-commonmark-ghpages="" />    </span><span class="p">}</span><span class="w"><br data-jekyll-commonmark-ghpages="" /></span><span class="p">}</span></code></pre></figure><p>В блоке dependencies мы будем указывать зависимости нашего проекта. Сейчас просто для теста это normalize и jQuery (хотя я уже не помню когда начинал проект без этих вещей).<p>Ну и конечно установим их командой:<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>bower i</code></pre></figure><p>Ну а теперь самое интересное. Создадим структуру нашего проекта и настроим сборщик.<h2 id="Структура-проекта">Структура проекта</h2><p>Это очень спорный момент. Конечно проекты бывают разные, так же как и предпочтения разработчиков. Стоит только взглянуть на сайт <a href="http://yeoman.io/generators/">yeoman.io</a> (кстати это очень классный инструмент, который предоставляет большое кол-во заготовленных основ для проекта со всякими плюшками. Однозначно стоит присмотреться к нему). Мы не будем ничего выдумывать и сделаем самую простую структуру.<p>Для начала нам понадобится 2 папки. Одна (src) в которой мы собственно будем писать код, и вторая (build), в которую сборщик будет выплевывать готовые файлы. Добавим их в проект. Текущая структура у нас выглядит так:<p><a href="/assets/images/front-end/nice-build-frontend-project/nice-build-frontend-project-01.png"><img src="/assets/images/front-end/nice-build-frontend-project/nice-build-frontend-project-01.png" alt="Структура проекта" /></a><p>В папке src создадим типичную структуру среднестатистического проекта. Сделаем main файлы в папках js/ и style/ и создадим первую html страничку такого содержания.<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="c">&lt;!-- index.html --&gt;</span><br data-jekyll-commonmark-ghpages="" /><span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"header"</span><span class="nt">&gt;</span><br data-jekyll-commonmark-ghpages="" />    Header<br data-jekyll-commonmark-ghpages="" /><span class="nt">&lt;/section&gt;</span><br data-jekyll-commonmark-ghpages="" /><br data-jekyll-commonmark-ghpages="" /><span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"content"</span><span class="nt">&gt;</span><br data-jekyll-commonmark-ghpages="" />    Content<br data-jekyll-commonmark-ghpages="" /><span class="nt">&lt;/section&gt;</span><br data-jekyll-commonmark-ghpages="" /><br data-jekyll-commonmark-ghpages="" /><span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"footer"</span><span class="nt">&gt;</span><br data-jekyll-commonmark-ghpages="" />    Footer<br data-jekyll-commonmark-ghpages="" /><span class="nt">&lt;/section&gt;</span></code></pre></figure><p>Структура папки src теперь будет выглядеть так:<p><a href="/assets/images/front-end/nice-build-frontend-project/nice-build-frontend-project-02.png"><img src="/assets/images/front-end/nice-build-frontend-project/nice-build-frontend-project-02.png" alt="Структура папки src" /></a><p>Тут все тривиально:<ul><li><strong>fonts</strong> — шрифты;<li><strong>img</strong> — картинки;<li><strong>js</strong> — скрипты. В корне этой папки будет только файл <strong>main.js</strong>, который пригодится нам для сборки. Все свои js файлы — надо будет класть в папку <strong>partials</strong>;<li><strong>style</strong> — стили. Тут так же в корне только <strong>main.scss</strong>, а рабочие файлы в папке <strong>partials</strong>;<li><strong>template</strong> — тут будем хранить повторяющиеся куски html кода;<li>Все html страницы которые мы верстаем — будут лежать в корне src;</ul><p>Добавим в <strong>partials</strong> первые js и scss файлы и напоследок — перейдем в корень нашего проекта и создадим там файл <strong>gulpfile.js</strong>. Вся папка проекта сейчас выглядит так:<p><a href="/assets/images/front-end/nice-build-frontend-project/nice-build-frontend-project-03.png"><img src="/assets/images/front-end/nice-build-frontend-project/nice-build-frontend-project-03.png" alt="gulpfile.js" /></a><p>Теперь все готово к настройке нашего сборщика, так что let’s rock!<h2 id="gulpfilejs">Gulpfile.js</h2><p>Вся магия будет заключена в этом файле. Для начала мы импортируем все наши плагины и сам gulp:<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// gulpfile.js</span><br data-jekyll-commonmark-ghpages="" /><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp'</span><span class="p">),</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">watch</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-watch'</span><span class="p">),</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">prefixer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-autoprefixer'</span><span class="p">),</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">uglify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-uglify'</span><span class="p">),</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">sass</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-sass'</span><span class="p">),</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">sourcemaps</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-sourcemaps'</span><span class="p">),</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">rigger</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-rigger'</span><span class="p">),</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">cssmin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-minify-css'</span><span class="p">),</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">imagemin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-imagemin'</span><span class="p">),</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">pngquant</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'imagemin-pngquant'</span><span class="p">),</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">rimraf</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'rimraf'</span><span class="p">),</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">browserSync</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"browser-sync"</span><span class="p">),</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">reload</span> <span class="o">=</span> <span class="nx">browserSync</span><span class="p">.</span><span class="nx">reload</span><span class="p">;</span></code></pre></figure><p>Конечно, не обязательно делать это именно так. Существует плагин <a href="https://www.npmjs.com/package/gulp-load-plugins">gulp-load-plugins</a> который позволяет не писать всю эту лапшу из require. Но мне нравится когда я четко вижу что и где подключается, и при желании могу это отключить. По этому пишу по старинке.<p>Так же создадим js объект в который пропишем все нужные нам пути, чтобы при необходимости легко в одном месте их редактировать:<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// gulpfile.js</span><br data-jekyll-commonmark-ghpages="" /><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="p">{</span><br data-jekyll-commonmark-ghpages="" />    <span class="na">build</span><span class="p">:</span> <span class="p">{</span><br data-jekyll-commonmark-ghpages="" />        <span class="na">html</span><span class="p">:</span> <span class="s1">'build/'</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />        <span class="na">js</span><span class="p">:</span> <span class="s1">'build/js/'</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />        <span class="na">css</span><span class="p">:</span> <span class="s1">'build/css/'</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />        <span class="na">img</span><span class="p">:</span> <span class="s1">'build/img/'</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />        <span class="na">fonts</span><span class="p">:</span> <span class="s1">'build/fonts/'</span><br data-jekyll-commonmark-ghpages="" />    <span class="p">},</span><br data-jekyll-commonmark-ghpages="" /><br data-jekyll-commonmark-ghpages="" />    <span class="na">src</span><span class="p">:</span> <span class="p">{</span><br data-jekyll-commonmark-ghpages="" />        <span class="na">html</span><span class="p">:</span> <span class="s1">'src/*.html'</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />        <span class="na">js</span><span class="p">:</span> <span class="s1">'src/js/main.js'</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />        <span class="na">style</span><span class="p">:</span> <span class="s1">'src/style/main.scss'</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />        <span class="na">img</span><span class="p">:</span> <span class="s1">'src/img/**/*.*'</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />        <span class="na">fonts</span><span class="p">:</span> <span class="s1">'src/fonts/**/*.*'</span><br data-jekyll-commonmark-ghpages="" />    <span class="p">},</span><br data-jekyll-commonmark-ghpages="" /><br data-jekyll-commonmark-ghpages="" />    <span class="na">watch</span><span class="p">:</span> <span class="p">{</span><br data-jekyll-commonmark-ghpages="" />        <span class="na">html</span><span class="p">:</span> <span class="s1">'src/**/*.html'</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />        <span class="na">js</span><span class="p">:</span> <span class="s1">'src/js/**/*.js'</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />        <span class="na">style</span><span class="p">:</span> <span class="s1">'src/style/**/*.scss'</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />        <span class="na">img</span><span class="p">:</span> <span class="s1">'src/img/**/*.*'</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />        <span class="na">fonts</span><span class="p">:</span> <span class="s1">'src/fonts/**/*.*'</span><br data-jekyll-commonmark-ghpages="" />    <span class="p">},</span><br data-jekyll-commonmark-ghpages="" /><br data-jekyll-commonmark-ghpages="" />    <span class="na">clean</span><span class="p">:</span> <span class="s1">'./build'</span><br data-jekyll-commonmark-ghpages="" /><span class="p">};</span></code></pre></figure><p>Создадим переменную с настройками нашего dev сервера:<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// gulpfile.js</span><br data-jekyll-commonmark-ghpages="" /><span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span><br data-jekyll-commonmark-ghpages="" />    <span class="na">server</span><span class="p">:</span> <span class="p">{</span><br data-jekyll-commonmark-ghpages="" />        <span class="na">baseDir</span><span class="p">:</span> <span class="s2">"./build"</span><br data-jekyll-commonmark-ghpages="" />    <span class="p">},</span><br data-jekyll-commonmark-ghpages="" /><br data-jekyll-commonmark-ghpages="" />    <span class="na">tunnel</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />    <span class="na">host</span><span class="p">:</span> <span class="s1">'localhost'</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />    <span class="na">port</span><span class="p">:</span> <span class="mi">9000</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />    <span class="na">logPrefix</span><span class="p">:</span> <span class="s2">"Frontend_Devil"</span><br data-jekyll-commonmark-ghpages="" /><span class="p">};</span></code></pre></figure><h3 id="Собираем-html">Собираем html</h3><p>Напишем таск для сборки html:<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// gulpfile.js</span><br data-jekyll-commonmark-ghpages="" /><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'html:build'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">html</span><span class="p">)</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">rigger</span><span class="p">())</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">build</span><span class="p">.</span><span class="nx">html</span><span class="p">))</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">reload</span><span class="p">({</span><span class="na">stream</span><span class="p">:</span> <span class="kc">true</span><span class="p">}));</span><br data-jekyll-commonmark-ghpages="" /><span class="p">});</span></code></pre></figure><p>Напомню, что rigger это наш плагин, позволяющий использовать такую конструкцию для импорта файлов:<figure class="highlight"><pre><code class="language-html" data-lang="html">//= template/footer.html</code></pre></figure><p>Давай те же применим его в деле!<p>В папке src/template/ — создадим файлы header.html и footer.html следующего содержания:<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="c">&lt;!-- header.html --&gt;</span><br data-jekyll-commonmark-ghpages="" /><span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"header"</span><span class="nt">&gt;</span><br data-jekyll-commonmark-ghpages="" />    Header<br data-jekyll-commonmark-ghpages="" /><span class="nt">&lt;/section&gt;</span></code></pre></figure><p>а наш файл index.html изменим вот так:<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="c">&lt;!-- index.html --&gt;</span><br data-jekyll-commonmark-ghpages="" />//= template/header.html<br data-jekyll-commonmark-ghpages="" /><br data-jekyll-commonmark-ghpages="" /><span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"content"</span><span class="nt">&gt;</span><br data-jekyll-commonmark-ghpages="" />    Content<br data-jekyll-commonmark-ghpages="" /><span class="nt">&lt;/section&gt;</span><br data-jekyll-commonmark-ghpages="" /><br data-jekyll-commonmark-ghpages="" />//= template/footer.html</code></pre></figure><p>Осталось перейти в консоль и запустить наш таск командой:<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>gulp html:build</code></pre></figure><p>После того как она отработает — идем в папку build и видим там наш файл index.html, который превратился в это:<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="c">&lt;!-- index.html --&gt;</span><br data-jekyll-commonmark-ghpages="" /><span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"header"</span><span class="nt">&gt;</span><br data-jekyll-commonmark-ghpages="" />    Header<br data-jekyll-commonmark-ghpages="" /><span class="nt">&lt;/section&gt;</span><br data-jekyll-commonmark-ghpages="" /><br data-jekyll-commonmark-ghpages="" /><span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"content"</span><span class="nt">&gt;</span><br data-jekyll-commonmark-ghpages="" />    Content<br data-jekyll-commonmark-ghpages="" /><span class="nt">&lt;/section&gt;</span><br data-jekyll-commonmark-ghpages="" /><br data-jekyll-commonmark-ghpages="" /><span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"footer"</span><span class="nt">&gt;</span><br data-jekyll-commonmark-ghpages="" />    Footer<br data-jekyll-commonmark-ghpages="" /><span class="nt">&lt;/section&gt;</span></code></pre></figure><p>Это же просто восхитительно!<p>Помню как много неудобств доставляло бегать по всем сверстанным страничкам и вносить изменения в какую-то повторяющуюся на них часть. Теперь это делается удобно в одном месте.<h3 id="Собираем-javascript">Собираем javascript</h3><p>Таск по сборке скриптов будет выглядеть так:<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// gulpfile.js</span><br data-jekyll-commonmark-ghpages="" /><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'js:build'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">js</span><span class="p">)</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">rigger</span><span class="p">())</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">sourcemaps</span><span class="p">.</span><span class="nx">init</span><span class="p">())</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">uglify</span><span class="p">())</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">sourcemaps</span><span class="p">.</span><span class="nx">write</span><span class="p">())</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">build</span><span class="p">.</span><span class="nx">js</span><span class="p">))</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">reload</span><span class="p">({</span><span class="na">stream</span><span class="p">:</span> <span class="kc">true</span><span class="p">}));</span><br data-jekyll-commonmark-ghpages="" /><span class="p">});</span></code></pre></figure><p>Помните наш файл main.js? Вся идея тут состоит в том, чтобы с помощью rigger’a инклюдить в него все нужные нам js файлы в нужном нам порядке. Именно ради контроля над порядком подключения — я и делаю это именно так, вместо того что бы попросить gulp найти все *.js файлы и склеить их.<p>Часто, при поиске места ошибки я по очереди выключаю какие то файлы из сборки, что бы локализовать место проблемы. В случае если бездумно склеивать все .js — дебаг будет усложнен. Заполним наш main.js:<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// main.js</span><br data-jekyll-commonmark-ghpages="" /><span class="cm">/* Third party */</span><br data-jekyll-commonmark-ghpages="" /><span class="c1">//= ../../bower_components/jquery/dist/jquery.js</span><br data-jekyll-commonmark-ghpages="" /><br data-jekyll-commonmark-ghpages="" /><span class="cm">/* Custom */</span><br data-jekyll-commonmark-ghpages="" /><span class="c1">//= partials/app.js</span></code></pre></figure><p>Именно так я делаю на боевых проектах. Вверху этого файла всегда идет подключение зависимостей, ниже подключение моих собственных скриптов.<p>Кстати, bower пакеты можно подключать через такой плагин как <a href="https://www.npmjs.com/package/gulp-bower">gulp-bower</a>. Но я опять же не делаю этого, потому что хочу самостоятельно определять что, где и как будет подключаться.<p>Осталось только запустить наш таск из консоли командой:<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>gulp js:build</code></pre></figure><p>И в папке build/js — мы увидим наш скомпилированный и сжатый файл.<h3 id="Собираем-стили">Собираем стили</h3><p>Напишем задачу для сборки нашего SCSS:<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// gulpfile.js</span><br data-jekyll-commonmark-ghpages="" /><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'style:build'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">style</span><span class="p">)</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">sourcemaps</span><span class="p">.</span><span class="nx">init</span><span class="p">())</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">sass</span><span class="p">())</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">prefixer</span><span class="p">())</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">cssmin</span><span class="p">())</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">sourcemaps</span><span class="p">.</span><span class="nx">write</span><span class="p">())</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">build</span><span class="p">.</span><span class="nx">css</span><span class="p">))</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">reload</span><span class="p">({</span><span class="na">stream</span><span class="p">:</span> <span class="kc">true</span><span class="p">}));</span><br data-jekyll-commonmark-ghpages="" /><span class="p">});</span></code></pre></figure><p>Здесь все просто, но вас могут заинтересовать настройки автопрификсера. По умолчанию он пишет префиксы необходимые для последних двух версий браузеров. В моем случае этого достаточно, но если вам нужны другие настройки — вы можете найти их <a href="https://www.npmjs.com/package/gulp-autoprefixer">тут</a>.<p>Со стилями я поступаю так же как и с js, но только вместо rigger’a — использую встроенный в SCSS импорт.<blockquote><p><strong>UPD (13 марта 2015):</strong> У некоторых людей возникла проблема с импортом css файлов инлайн. Как оказалось, gulp-sass не умеет этого делать, и на выходе дает простой CSS импорт. Но этот вопрос решает наш плагин gulp-minify-css, который заменяет CSS импорт на содержимое файла.</blockquote><p>Наш main.scss будет выглядеть так:<figure class="highlight"><pre><code class="language-scss" data-lang="scss"><span class="c1">// main.scss<br data-jekyll-commonmark-ghpages="" /></span><span class="cm">/* Third Party */</span><br data-jekyll-commonmark-ghpages="" /><span class="k">@import</span> <span class="s2">"../../bower_components/normalize.css/normalize.css"</span><span class="p">;</span><br data-jekyll-commonmark-ghpages="" /><br data-jekyll-commonmark-ghpages="" /><span class="cm">/* Custom */</span><br data-jekyll-commonmark-ghpages="" /><span class="k">@import</span> <span class="s2">"./partials/app"</span><span class="p">;</span></code></pre></figure><p>Таким способом получается легко управлять порядком подключения стилей. Проверим наш таск, запустив:<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>gulp style:build</code></pre></figure><h3 id="Собираем-картинки">Собираем картинки</h3><p>Таск по картинкам будет выглядеть так:<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// gulpfile.js</span><br data-jekyll-commonmark-ghpages="" /><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'image:build'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">img</span><span class="p">)</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">imagemin</span><span class="p">({</span><br data-jekyll-commonmark-ghpages="" />            <span class="na">progressive</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />            <span class="na">svgoPlugins</span><span class="p">:</span> <span class="p">[{</span><span class="na">removeViewBox</span><span class="p">:</span> <span class="kc">false</span><span class="p">}],</span><br data-jekyll-commonmark-ghpages="" />            <span class="na">use</span><span class="p">:</span> <span class="p">[</span><span class="nx">pngquant</span><span class="p">()],</span><br data-jekyll-commonmark-ghpages="" />            <span class="na">interlaced</span><span class="p">:</span> <span class="kc">true</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">}))</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">build</span><span class="p">.</span><span class="nx">img</span><span class="p">))</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">reload</span><span class="p">({</span><span class="na">stream</span><span class="p">:</span> <span class="kc">true</span><span class="p">}));</span><br data-jekyll-commonmark-ghpages="" /><span class="p">});</span></code></pre></figure><p>Я использую дефолтные настройки imagemin, за исключением interlaced. Подробнее об API этого плагина можно прочесть <a href="https://github.com/sindresorhus/gulp-imagemin">тут</a>.<p>Теперь, если мы положим какую-нибудь картинку в src/img и запустим команду:<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>gulp image:build</code></pre></figure><p>то увидим в build нашу оптимизированную картинку. Так же gulp любезно напишет в консоли сколько места он сэкономил для пользователей нашего сайта.<h3 id="Шрифты">Шрифты</h3><p>Со шрифтами мне обычно не нужно проводить никаких манипуляций, но что бы не рушить парадигму «Работаем в src/ и собираем в build/» — я просто копирую файлы из src/fonts и вставляю в build/fonts. Вот таск:<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// gulpfile.js</span><br data-jekyll-commonmark-ghpages="" /><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'fonts:build'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">fonts</span><span class="p">)</span><br data-jekyll-commonmark-ghpages="" />        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">build</span><span class="p">.</span><span class="nx">fonts</span><span class="p">))</span><br data-jekyll-commonmark-ghpages="" /><span class="p">});</span></code></pre></figure><p>Теперь давайте определим таск с именем «build», который будет запускать все что мы с вами тут накодили:<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// gulpfile.js</span><br data-jekyll-commonmark-ghpages="" /><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'build'</span><span class="p">,</span> <span class="p">[</span><br data-jekyll-commonmark-ghpages="" />    <span class="s1">'html:build'</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />    <span class="s1">'js:build'</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />    <span class="s1">'style:build'</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />    <span class="s1">'fonts:build'</span><span class="p">,</span><br data-jekyll-commonmark-ghpages="" />    <span class="s1">'image:build'</span><br data-jekyll-commonmark-ghpages="" /><span class="p">]);</span></code></pre></figure><h3 id="Изменения-файлов">Изменения файлов</h3><p>Чтобы не лазить все время в консоль давайте попросим gulp каждый раз при изменении какого то файла запускать нужную задачу. Для этого напишет такой таск:<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// gulpfile.js</span><br data-jekyll-commonmark-ghpages="" /><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'watch'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">watch</span><span class="p">([</span><span class="nx">path</span><span class="p">.</span><span class="nx">watch</span><span class="p">.</span><span class="nx">html</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span><br data-jekyll-commonmark-ghpages="" />        <span class="nx">gulp</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="s1">'html:build'</span><span class="p">);</span><br data-jekyll-commonmark-ghpages="" />    <span class="p">});</span><br data-jekyll-commonmark-ghpages="" /><br data-jekyll-commonmark-ghpages="" />    <span class="nx">watch</span><span class="p">([</span><span class="nx">path</span><span class="p">.</span><span class="nx">watch</span><span class="p">.</span><span class="nx">style</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span><br data-jekyll-commonmark-ghpages="" />        <span class="nx">gulp</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="s1">'style:build'</span><span class="p">);</span><br data-jekyll-commonmark-ghpages="" />    <span class="p">});</span><br data-jekyll-commonmark-ghpages="" /><br data-jekyll-commonmark-ghpages="" />    <span class="nx">watch</span><span class="p">([</span><span class="nx">path</span><span class="p">.</span><span class="nx">watch</span><span class="p">.</span><span class="nx">js</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span><br data-jekyll-commonmark-ghpages="" />        <span class="nx">gulp</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="s1">'js:build'</span><span class="p">);</span><br data-jekyll-commonmark-ghpages="" />    <span class="p">});</span><br data-jekyll-commonmark-ghpages="" /><br data-jekyll-commonmark-ghpages="" />    <span class="nx">watch</span><span class="p">([</span><span class="nx">path</span><span class="p">.</span><span class="nx">watch</span><span class="p">.</span><span class="nx">img</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span><br data-jekyll-commonmark-ghpages="" />        <span class="nx">gulp</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="s1">'image:build'</span><span class="p">);</span><br data-jekyll-commonmark-ghpages="" />    <span class="p">});</span><br data-jekyll-commonmark-ghpages="" /><br data-jekyll-commonmark-ghpages="" />    <span class="nx">watch</span><span class="p">([</span><span class="nx">path</span><span class="p">.</span><span class="nx">watch</span><span class="p">.</span><span class="nx">fonts</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span><br data-jekyll-commonmark-ghpages="" />        <span class="nx">gulp</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="s1">'fonts:build'</span><span class="p">);</span><br data-jekyll-commonmark-ghpages="" />    <span class="p">});</span><br data-jekyll-commonmark-ghpages="" /><span class="p">});</span></code></pre></figure><p>С понимаем не должно возникнуть проблем. Мы просто идем по нашим путям определенным в переменной path, и в функции вызывающейся при изменении файла — просим запустить нужный нам таск. Попробуйте запустить в консоли:<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>gulp watch</code></pre></figure><p>И поменяйте разные файлы. Ну не круто ли?<h3 id="Веб-сервер">Веб сервер</h3><p>Что бы насладиться чудом livereload — нам необходимо создать себе локальный веб-сервер. Для этого напишем следующий простой таск:<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// gulpfile.js</span><br data-jekyll-commonmark-ghpages="" /><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'webserver'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">browserSync</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span><br data-jekyll-commonmark-ghpages="" /><span class="p">});</span></code></pre></figure><p>Тут даже нечего комментировать. Мы просто запустим livereload сервер с настройками, которые мы определили в объекте config. К тому же gulp вежливо откроет наш проект в браузере, а в консоль напишет ссылки на локальный сервер, и на тунель, который мы можем скинуть заказчику для демонстрации.<h3 id="Очистка">Очистка</h3><p>Если вы добавите какую-нибудь картинку, потом запустите задачу image:build и потом картинку удалите — она останется в папке build. Так что было бы удобно — периодически подчищать ее. Создадим для этого простой таск:<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// gulpfile.js</span><br data-jekyll-commonmark-ghpages="" /><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'clean'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">){</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">rimraf</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">clean</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span><br data-jekyll-commonmark-ghpages="" /><span class="p">});</span></code></pre></figure><p>Теперь при запуске команды:<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>gulp clean</code></pre></figure><p>просто будет удаляться папка build.<h3 id="Финальный-аккорд">Финальный аккорд</h3><p>Последним делом — мы определим дефолтный таск, который будет запускать всю нашу сборку.<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// gulpfile.js</span><br data-jekyll-commonmark-ghpages="" /><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'default'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'build'</span><span class="p">,</span> <span class="s1">'webserver'</span><span class="p">,</span> <span class="s1">'watch'</span><span class="p">]);</span></code></pre></figure><p>Окончательно ваш gulpfile.js будет выглядеть примерно вот <a href="https://gist.github.com/Insayt/272c9b81936a03884768">так</a>. Теперь выполним в консоли:<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>gulp</code></pre></figure><p>И вуаля. Заготовка для вашего проекта готова и ждет вас.<h2 id="Пара-слов-в-заключение">Пара слов в заключение</h2><p>Эта статья задумывалась как способ еще раз освежить в памяти тонкости сборки frontend проектов, и для легкости передачи этого опыта новым разработчикам. Вам не обязательно использовать на своих проектах именно такой вариант сборки. Есть yeoman.io, на котором вы найдете генераторы почти под любые нужды.<p>Я написал этот сборщик по трём причинам.<ul><li>Мне нравится использовать rigger в своем html коде;<li>Почти во всех сборках что я встречал — используется временная папка (обычно .tmp/), для записи промежуточных результатов сборки. Мне не нравится такой подход и я хотел избавиться от временных папок;<li>И я хотел что бы все это было у меня из коробки.</ul><p>Мою рабочую версию сборщика вы можете скачать на моем <a href="https://github.com/Insayt/frontend-devil">github</a>. Надеюсь, статья оказалась полезной для вас.<p>P.S. Обо всех ошибках, недочетах и косяках — пожалуйста пишите в личку.<p align="right"><small><em>Источник: https://habrahabr.ru/post/250569/</em></small><div class="post-links"> <a class="link-to-post" href="/blog/how-to-display-information-only-on-main-page/"> <span class="link-to-post__next">&#10535; &nbsp;Next post</span> <span class="link-to-post__title">Как отображать информацию только на главной странице</span> </a> <a class="link-to-post" href="/blog/of-open-source-in-russian-language-does-not-exist/"> <span class="link-to-post__prev">&#10535; &nbsp;Previous post</span> <span class="link-to-post__title">Опенсорса на русском языке не существует</span> </a></div></div></article></main><footer class="blog-footer content-wrapper"><p>&copy; <span class="full-year"></span> denisnovikov.github.io</footer><script src="/assets/js/scripts.js"></script>  <script type="text/javascript"> (function (d, w, c) { (w[c] = w[c] || []).push(function () { try { w.yaCounter45975960 = new Ya.Metrika({ id: 45975960, clickmap: true, trackLinks: true, accurateTrackBounce: true, webvisor: true }); } catch (e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = "https://mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks"); </script> <noscript><div> <img src="https://mc.yandex.ru/watch/45975960" style="position:absolute; left:-9999px;" alt="" /></div></noscript>  <!--Openstat--> <span id="openstat1"></span> <script type="text/javascript"> var openstat = { counter: 1, next: openstat }; (function(d, t, p) { var j = d.createElement(t); j.async = true; j.type = "text/javascript"; j.src = ("https:" == p ? "https:" : "http:") + "//openstat.net/cnt.js"; var s = d.getElementsByTagName(t)[0]; s.parentNode.insertBefore(j, s); })(document, "script", document.location.protocol); </script> <!--/Openstat-->
