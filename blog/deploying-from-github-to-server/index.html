<!DOCTYPE html><html lang="ru"><head>  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-89748707-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-89748707-1'); </script><base href="https://denisnovikov.github.io"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="google-site-verification" content="aiV-7fBXdNhcJILKp5GXFesXJetzCgLWAbif-tZKfrY" /><meta name="yandex-verification" content="41a2ad868168b23f" /><meta name="openstat-verification" content="62f671b1eaa0d2a7ce234219685a42b3d7770961" /><meta property="op:markup_version" content="v1.0"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="application-name" content="FrontEnd Blog"><meta name="format-detection" content="telephone=no"><meta name="generator" content="jekyll"><meta name="google" content="notranslate"><meta name="rating" content="General"><meta name="referrer" content="never"><meta name="robots" content="index,follow,noodp"><meta name="subject" content="blog"><meta name="url" content="https://denisnovikov.github.io"><meta name="viewport" content="width=device-width, initial-scale=1"><title> Развертывание с GitHub на сервер - denisnovikov.github.io</title><meta name="description" content="GitHub, равно как и система контроля версий Git, на которой он основан, это фантастические инструменты для организации работы и взаимодействия в проектах, не..."><link rel="alternate" hreflang="ru" href="/blog/deploying-from-github-to-server/" /><link rel="canonical" href="https://denisnovikov.github.io/blog/deploying-from-github-to-server/"><link rel="author" href="DNovikov"><link rel="me" href="https://github.com/denisnovikov" type="text/html"><link rel="me" href="mailto:dnovikov1808@gmail.com"><link href='https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|Roboto+Condensed:700&subset=latin' rel='stylesheet' type='text/css'><link rel="stylesheet" href="/assets/css/main.css"><meta property="og:url" content="https://denisnovikov.github.io/blog/deploying-from-github-to-server/"><meta property="og:type" content="website"><meta property="og:title" content="Развертывание с GitHub на сервер"><meta property="og:description" content="GitHub, равно как и система контроля версий Git, на которой он основан, это фантастические инструменты для организации работы и взаимодействия в проектах"><meta property="og:site_name" content="denisnovikov.github.io"><meta property="og:locale" content="ru_RU"><meta property="article:author" content="DNovikov"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@dev_novikov"><meta name="twitter:creator" content="@dev_novikov"><meta name="twitter:url" content="https://denisnovikov.github.io/blog/deploying-from-github-to-server/"><meta name="twitter:title" content="Развертывание с GitHub на сервер"><meta name="twitter:description" content="GitHub, равно как и система контроля версий Git, на которой он основан, это фантастические инструменты для организации работы и взаимодействия в проектах"><meta property="og:image" content="https://denisnovikov.github.io/assets/images/bg.svg"><meta name="twitter:image" content="https://denisnovikov.github.io/assets/images/bg.svg"><body><div id="shadow"></div><header class="main-header content-wrapper"> <input type="checkbox" id="menu-checkbox" /><nav class="center-wrapper nav-main"> <a class="blog-logo" href="/">denisnovikov.github.io</a> <a href="/about/">О проекте</a> <a href="/blog/">Все записи блога</a> <a href="/feed.xml" rel="alternate" type="application/rss+xml">RSS</a> <label for="menu-checkbox" class="toggle-button" data-open="☰" data-close="☰" onclick></label></nav></header><aside class="sidebar" role="note" style=" background-image: url( /assets/images/front-end/deploying-from-github-to-server/preview-deploying-from-github-to-server.jpg )"><div class="cover"><div class="cover-text"><div class="heading"> <a href="/blog/#front-end">front-end</a></div><p> GitHub, равно как и система контроля версий Git, на которой он основан, это фантастические инструменты для организации работы и взаимодействия в проектах Развертывание с GitHub на сервер</div></div><div id="switcher"></div></aside><main class="content-wrapper"><article class="post"><h1 class="post-title">Развертывание с GitHub на сервер</h1><p class="post-meta"> <time datetime="2016-07-20">20-07-2016</time> &nbsp;/&nbsp; <span>prgssr.ru</span><div class="post-content"><p>GitHub, равно как и система контроля версий Git, на которой он основан, это фантастические инструменты для организации работы и взаимодействия в проектах, независимо от того, связаны эти проекты с кодом или нет.<p>В этой статье мы рассмотрим способы, позволяющие улучшить интеграцию Git и GitHub в рабочий процесс разработчиков, облегчая и механизируя процесс развертывания.<p>Я разделил все эти способы по типам используемых инструментов: отдельно инструменты для автоматического тестирования и отдельно проверяющие развертывание на сервере.<h2 id="Зачем-это-нужно">Зачем это нужно</h2><p>Автоматизация этих процессов позволит вам и вашей команде сфокусироваться на создании, согласовании и объединении кода вместо того, чтобы тратить часы на развертывание и прочие повторяющиеся задачи при каждой новой сборке или изменении.<h2 id="Недостатки-автоматизации">Недостатки автоматизации</h2><p>Основная проблема с автоматическим развертыванием изменений это и есть автоматическое развертывание изменений. У вас должна быть уверенность в своей команде и в написанном коде. Именно поэтому автоматическое развертывание обычно совмещается с автоматическим тестированием и это отразилось на представленных ниже инструментах.<p>Конечно, это также означает, что все небольшие вопросы должны решаться одинаково быстро. Автоматизация должна сочетаться с коммуникацией. Если отправка в репозиторий основной ветки может запускать процесс сборки, то должно быть понятно, когда это происходит и кто может это вызвать.<p>Первоначальная настройка автоматизации может занять некоторое время. Важно заранее подумать о том, действительно ли это необходимо вашей команде и вашему рабочему процессу. Добавьте количество времени, которое вы тратите на тестирование и развертывание новых сборок — и если это занимает больше нескольких минут каждый раз, то оно того стоит.<h2 id="Хуки-git">Хуки Git</h2><p>В <a href="http://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks">Git есть набор встроенных хуков</a> (или <a href="https://git-scm.com/book/ru/v1/Настройка-Git-Перехватчики-в-Git">перехватчиков</a>), которые могут быть использованы для автоматизации и обычно они являются первой остановкой для выполнения каких-либо задач после действий Git. Хуки делятся на серверные и клиентские.<p>Хуки с серверной стороны предназначены для таких событий, как прослушивание сетевых операций — например, когда репозиторий принимает отправку. Клиентские хуки запускаются при действиях, происходящих на компьютере разработчика, например, коммитах и объединении веток.<p>Полный <a href="http://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks">список хуков есть в документации Git</a>. Я рассмотрю пару из них для начала. Надеюсь, это поможет вам понять, насколько полезны они могут быть в ваших проектах и в рабочем процессе (не автоматизированном).<h2 id="Хук-pre-commit">Хук <code class="highlighter-rouge">pre-commit</code></h2><p>Клиентский хук запускается до любого другого хука и до коммита любых изменений. Это лучшее место для добавления тестов и прочих проверок вашего кода.<p>Добавим простой код JavaScript (в котором мы заранее сделали ошибку) в наш небольшой проект:<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nb">document</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><br data-jekyll-commonmark-ghpages="" />    <span class="nx">alert</span><span class="p">(</span><span class="s2">"Hello World"</span><span class="p">)</span><br data-jekyll-commonmark-ghpages="" /><span class="p">};</span></code></pre></figure><p>Мы будем использовать JSHint для выявления ошибок в JavaScript ( <a href="http://jshint.com/install/">инструкция по установке JSHint</a>).<p>Переименуем файл <code class="highlighter-rouge">hooks/pre-commit.sample</code> (этот файл расположен в скрытом каталоге <code class="highlighter-rouge">.git вашего проекта) в </code>hooks/pre-commit` и изменим содержимое этого файла на следующее:<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/sh</span><br data-jekyll-commonmark-ghpages="" />jshint index.js</code></pre></figure><p>Попытаемся сделать коммит изменений:<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git commit <span class="nt">-m</span> <span class="s2">"adding Javascript file"</span></code></pre></figure><p>И получим следующее сообщение об ошибке:<figure class="highlight"><pre><code class="language-bash" data-lang="bash">index.js: line 5, col 25, Missing semicolon.<br data-jekyll-commonmark-ghpages="" />1 error</code></pre></figure><p>Добавим недостающую точку с запятой и попытаемся еще раз. Коммит пройдет без каких-либо проблем.<h2 id="Хук-post-receive">Хук post-receive</h2><p>Этот серверный хук срабатывает после завершения получения переданных изменений в удаленном Git-репозитории. В нашем примере, мы передаем последнюю версию нашего простого сайта в каталог веб-сервера для развертывания.<p>У меня есть существующий сайт, состоящий из <code class="highlighter-rouge">index.html</code> и нескольких страниц еще, которые мы будем использовать в следующих примерах. Вы можете создать свой сайт или использовать <a href="https://github.com/sitepoint-editors/GitHub-Auto-Deploy">пример из демо-репозитория</a>.<p>Клонируйте репозиторий, используя флаг <code class="highlighter-rouge">--bare</code>, чтобы в репозитории была только информация из системы контроля версий, а не наш код:<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git clone <span class="nt">--bare</span> https://github.com/sitepoint-editors/GitHub-Auto-Deploy.git GitHub-Auto-Deploy.git</code></pre></figure><p>Теперь создадим хук:<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd </span>GitHub-Auto-Deploy.git/hooks<br data-jekyll-commonmark-ghpages="" /><span class="nv">$ </span>vi post-receive</code></pre></figure><p>Добавим в файл с хуком следующие строчки:<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/sh</span><br data-jekyll-commonmark-ghpages="" />git <span class="nt">--work-tree</span><span class="o">=</span>/var/www/html <span class="nt">--git-dir</span><span class="o">=</span>/var/repo/GitHub-Auto-Deploy.git checkout <span class="nt">-f</span></code></pre></figure><blockquote><p>Примечание: указаны рабочие каталоги в Ubuntu, в вашей системе они могут отличаться.</blockquote><p>Эта команда извлекает текущий репозиторий в указанный рабочий каталог, но без данных системы контроля версий.<p>Нам надо сделать наш хук выполняемым:<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">sudo </span>chmod +x post-receive</code></pre></figure><p>На своей локальной машине, клонируйте репозиторий в обычном режиме, используя инструмент по своему выбору и добавьте новый удаленный сервер (не забудьте добавить настройки своего сервера).<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git remote add prod ssh://user@domain.com/var/repo/GitHub-Auto-Deploy.git</code></pre></figure><p>Для развертывания на рабочий сервер вместо репозитория введите:<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git push prod master</code></pre></figure><p>Если вы посмотрите теперь в каталог <code class="highlighter-rouge">var/www/html</code>, то вы найдете там автоматически скопированный файл <code class="highlighter-rouge">index.html</code>.<p>Если вы используете свой собственный репозиторий Git, то он расположен на том же сервере, что и ваше приложение и процесс развертывания теперь автоматизирован. Если вы используете Github или иной сторонний сервис Git, этот хук не будет полностью автоматизировать ваш рабочий процесс, а скорее сократит его на один шаг. В дальнейшем мы это упростим.<p>Один из вариантов это использование команд <a href="http://linux.die.net/man/1/rsync">rsync</a> или <a href="http://www.hypexr.org/linux_scp_help.php">scp</a> в хуке <code class="highlighter-rouge">post-receive</code> на GitHub. Другой вариант, особенно, если ваше приложение нуждается в процессе сборки перед запуском (Github ограничивает доступные команды) — это использование хука <code class="highlighter-rouge">post-receive</code> для запуска скриптов на сервере приложения, проверяющего код на GitHub (с опцией <code class="highlighter-rouge">-f</code>) и запускающему остальные необходимые команды. Как видите, все стало несколько сложнее, нам пора перейти к следующему набору инструментов.<h2 id="Автоматическое-развертывание-непосредственно-с-github">Автоматическое развертывание непосредственно с GitHub</h2><p>На GitHub есть документация об автоматизации развертывания на платформы интеграции, некоторые из которых также являются хостинг-провайдерами.<p>Буду честным, большая часть изученной мной документации оказалась некорректной, неточной или бесполезной, поэтому я добавлю ссылки на документацию нескольких популярных хостинг-провайдеров, а для остальных я предлагаю вам использовать <code class="highlighter-rouge">post-receive</code> или методы непрерывной интеграции:<ul><li><a href="https://devcenter.heroku.com/articles/github-integration#automatic-deploys">Heroku</a><li><a href="https://blogs.aws.amazon.com/application-management/post/Tx33XKAKURCCW83/Automatically-Deploy-from-GitHub-Using-AWS-CodeDeploy">AWS</a><li><a href="http://blog.davidebbo.com/2013/04/publishing-to-azure-web-sites-from-any.html">Azure</a></ul><h2 id="Сервисы-непрерывной-интеграции">Сервисы непрерывной интеграции</h2><p>Существует множество сервисов, способных отслеживать ваши репозитории на GitHub и не только производить развертывание с них, но и совершать другие действия, такие как запуск тестов и сборка.<p>Перейдя к новому и более сложному примеру, мы могли бы использовать сервис непрерывной интеграции для автоматизации процесса сборки проекта. В первую очередь после получения ветки <code class="highlighter-rouge">Master</code> из репозитория запускается скрипт bash, выполняющий сборку и развертывание, затем генерируется твит об обновлении. Сервис непрерывной интеграции может физически находится на одном сервере с веб-сервисом или на разных, в зависимости от ваших предпочтений.<p>Рассмотрим самые популярные из них.<h3 id="jenkins"><a href="https://jenkins-ci.org/">Jenkins</a></h3><p>Для использования вам надо настроить свой сервер с Jenkins, это даст вам полный контроль над ним, но заставит тратить время на поддержку. К счастью, Jenkins поддерживает многие платформы, в том числе Docker, если вы хотите для начала поэкспериментировать.<p>Большая часть функциональности Jenkins достигнута за счет плагинов, а благодаря сложившемуся за долгие годы open-source сообществу этих плагинов много. Например, есть плагины для <a href="https://wiki.jenkins-ci.org/display/JENKINS/Git+Plugin">Git</a>, <a href="https://wiki.jenkins-ci.org/display/JENKINS/GitHub+Plugin">GitHub</a> и <a href="https://wiki.jenkins-ci.org/display/JENKINS/Twitter+Plugin">Twitter</a>.<p>Jenkins требует долгой настройки и временами совмещение всех имеющихся инструкций для создания подходящего рабочего процесса требует изучения.<h3 id="travis"><a href="https://travis-ci.org/">Travis</a></h3><p>Инструкции по интеграции с Travis, имеющиеся на GitHub, на данный момент устарели. Но решается это просто: для этого есть <a href="https://docs.travis-ci.com/user/getting-started/">документация на сайте Travis</a>.<p>Travis не требует какой-либо настройки сервера или хостинга, поэтому он подойдет тем, кто не хочет тратить на это время. Тем не менее, расширение его за пределы дефолтных настроек потребует дополнительного конфигурирования. Например, <a href="https://docs.travis-ci.com/user/notifications/#Webhook-notification">Tweeting</a> требует доступ к веб-хукам.<p>Travis имеет привычку медленно замечать обновления в ваших репозиториях, особенно если эти изменения произведены в файле настроек самого Travis. Эти проблемы тяжело решить, если у вас нет доступа к серверу Travis.<h3 id="Другие-коммерческие-сервисы">Другие коммерческие сервисы</h3><p>Системы интеграции становятся все популярнее, появляется все больше новых сервисов и приложений — многие из них выпущены разработчиками инструментов, которые вы уже используете, и они будут плавно интегрироваться в существующие рабочие цепочки.<ul><li><a href="https://buddy.works/">https://buddy.works/</a><li><a href="https://www.atlassian.com/software/bamboo/">https://www.atlassian.com/software/bamboo/</a><li><a href="https://www.jetbrains.com/teamcity/">https://www.jetbrains.com/teamcity/</a><li><a href="https://codeship.com/">https://codeship.com/</a><li><a href="https://circleci.com/">https://circleci.com/</a><li><a href="https://saucelabs.com/">https://saucelabs.com/</a><li><a href="https://about.gitlab.com/gitlab-ci/">https://about.gitlab.com/gitlab-ci/</a><li><a href="http://deploybot.com/">http://deploybot.com/</a></ul><h2 id="Заключение">Заключение</h2><p>Надеюсь, это краткое введение разъяснит вам отдельные вопросы, касающиеся работы развертывания. Мы определенно прошли долгий путь со времен отправки файлов на сервер с помощью FTP.<p align="right"><small><em>Источник: http://prgssr.ru/development/razvertyvanie-s-github-na-server.html</em></small><div class="post-links"> <a class="link-to-post" href="/blog/customize-login-screen-lightdm-gtk-greeter/"> <span class="link-to-post__next">&#10535; &nbsp;Next post</span> <span class="link-to-post__title">Настройка экрана входа lightdm-gtk-greeter</span> </a> <a class="link-to-post" href="/blog/syntax-highlighting-of-source-code-on-website/"> <span class="link-to-post__prev">&#10535; &nbsp;Previous post</span> <span class="link-to-post__title">Подсветка синтаксиса исходного кода на сайте</span> </a></div></div></article></main><footer class="blog-footer content-wrapper"><p>&copy; <span class="full-year"></span> denisnovikov.github.io</footer><script src="/assets/js/scripts.js"></script>  <script type="text/javascript"> (function (d, w, c) { (w[c] = w[c] || []).push(function () { try { w.yaCounter45975960 = new Ya.Metrika({ id: 45975960, clickmap: true, trackLinks: true, accurateTrackBounce: true, webvisor: true }); } catch (e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = "https://mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks"); </script> <noscript><div> <img src="https://mc.yandex.ru/watch/45975960" style="position:absolute; left:-9999px;" alt="" /></div></noscript>  <!--Openstat--> <span id="openstat1"></span> <script type="text/javascript"> var openstat = { counter: 1, next: openstat }; (function(d, t, p) { var j = d.createElement(t); j.async = true; j.type = "text/javascript"; j.src = ("https:" == p ? "https:" : "http:") + "//openstat.net/cnt.js"; var s = d.getElementsByTagName(t)[0]; s.parentNode.insertBefore(j, s); })(document, "script", document.location.protocol); </script> <!--/Openstat-->
